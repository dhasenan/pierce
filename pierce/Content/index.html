<!DOCTYPE html>

<html>
  <head>
    <meta charset='utf-8'>
    <title>Pierce RSS Reader</title>
    <!--<link rel='stylesheet' href='dock-manager.css'>-->
    <link rel='stylesheet' href='sunny.css' />
    <link rel='stylesheet' href='pierceweb.css' />
    <link rel='icon' href='/Content/favicon.ico' />
    <script type='text/javascript' src='jquery-1.9.1.js'></script>
    <script type='text/javascript' src='jquery-ui-1.10.2.js'></script>
    <script type='text/javascript' src='jquery.layout.js'></script>
    <script type='text/javascript' src='underscore-min.js'></script>
    <script type='text/javascript' src='app.js'></script>

    <!-- underscore templates! -->
    <script id='labelListTemplate' type='text/html'>
      <% $.each(labels, function(i, label) { 
        var count = domain.unreadCount(label);
        var classes = 'labelBox';
        var labelclass = 'labelName';
        var name = label.Title;
        if (ui.isExpanded(label.Id)) classes += ' expanded';
        if (ui.currentLabel && label.Id == ui.currentLabel.Id) classes += ' selectedItem';
        if (count > 0) {
          labelclass += ' unread';
          name += ' (' + count + ')';
        }
      %>
      <div id='labelBox_<%= label.Id %>' class='<%= classes %>'>
        <table style='width: 100%; text-align: left'>
          <tr>
            <td style='width: 1.2em'>
              <span id='expander_<%= label.Id %>' class='ui-icon ui-icon-circle-minus'
                onclick='ui.toggleExpanded("<%= label.Id %>")'></span>
            </td>
            <td>
              <span id='labelName_<%= label.Id %>' class='<%= labelclass %>'
                  onclick='ui.showLabel("<%= label.Id %>")'
                  style='float: left'
                  >
                <%- name %>
              </span><!-- labelName -->
            </td>
          </tr>
        </table>
        <div id='labelContent_<%= label.Id %>' class='labelContent'>
          <%= ui.template('feedlistTemplate', { feeds: label.Feeds, labelId: label.Id }) %>
        </div><!-- labelContent -->
      </div><!-- labelBox -->
      <%}); %>
    </script>

    <script id='feedlistTemplate' type='text/html'>
      <% $.each(feeds, function(i, feed) { %>
        <div class='feedRow feedRow_<%= feed.Id %>'
          onclick='ui.showFeed("<%= feed.Id %>", "<%= labelId %>")'>
          <span style='float: left; overflow: hidden; text-overflow: ellipsis; width: 90%'>
            <%= ui.template('feedli', { feed: feed }) %>
          </span>
          <% if (!feed.Autogenerated) { %>
            <span style='width: 1em; float: right'>
              <%= ui.template('feedmenubutton', { feed: feed }) %>
            </span>
          <% } %>
        </div>
      <% }); %>
    </script>

    <script id='feedli' type='text/html'>
      <span class='feedli_<%- feed.Id %> feedli<%
        var unreadc = domain.unreadCount(feed);
        if (unreadc > 0) print(' unread');
        if (ui.currentFeed && ui.currentFeed.Id == feed.Id) {
          print(' selectedItem');
        } %>'>
        <% if (feed.IconUri) { %>
          <img style='height: 16px; width: 16px;' src='<%- feed.IconUri %>'></img>
        <% } else { %>
          <img style='height: 16px; width: 16px;' src='/Content/no-icon.png'></img>
        <% } %>
        <%-  feed.Title  %>
        <%
          if (unreadc) print(' (' + unreadc + ')');
        %>
      </span>
    </script>

    <script id='feedmenubutton' type='text/html'>
      <span
        style='float: right; height: 1em; width: 1em'
        class='ui-icon ui-icon-triangle-e'
        onclick='ui.showUpdateFeedWindow("<%= feed.Id %>")'
      >
      </span>
    </script>

    <script id='articleli' type='text/html'>
      <div
        id='<%- util.articleId(feed, article) %>'
        class='articleli <%- article.IsRead ? "read" : "unread" %>'
        onclick='ui.showArticle("<%= feed.Id %>", "<%= article.Id %>");'>
        <img style='height: 16px; width: 16px;' src='<%= feed.IconUri %>'></img>
        <%- ui.fmtDate(article.PublishDate) %>
        <%- article.Title %>
      </div>
    </script>

    <script id='articlefull' type='text/html'>
      <div>
        <img style='float: left' src='<%= feed.ImageUri %>'></img>
        <h3><a href="<%= article.Link %>"><%- article.Title %></a> - <%- feed.Title %></h3>
        <div><%- ui.fmtDate(article.PublishDate) %>
          <% if (ui.authors(article)) { %> -- by <%= ui.authors(article) %><% } %></div>
        <!-- as a special case, load this with html unescaped -->
        <frame><%= article.Description || article.Summary %></frame>
      </div>
    </script>

    <script id='authorLink' type='text/html'>
      <% if (author.Link) {%>
        <a href="<%= author.Link %>"><%- author.Name %></a>
      <% } else { %>
        <%- author.Name %>
      <% }%>
    </script>
  </head>
  <body>
    <div id='headerBar'>
      <span id='userName'>Not logged in</span>
      <span style='float: right'>Settings</span>
    </div>
    <div id='mainPanel'>
      <div id='articleView' caption='Current article' class='articleView'>
        <div class='paneTitle'>Article</div>
        <div class='content'>
          I need an article.
        </div>
      </div>
      <div id='articleList' caption='Articles' class='articleList'>
        <div class='paneTitle'>
          <span>Articles</span>
          <span style='float: right'>
            <a id='toggleUnread' href='#' onclick='ui.toggleUnreadOnly()'>Unread</a>
          </span>
        </div>
        <div class='content'>
          A list of articles, natch.
        </div>
      </div>

      <div id='feedList' caption='Feeds' class='feedList'>
        <div class='paneTitle'>Feeds</div>
        <div class='content'>
          I need some feeds.
        </div>
        <div style='float: bottom; border-top: 1px solid #aaa'>
          <a id='addFeedButton' href='#'>Add a feed</a>
        </div>
      </div>

      <!-- Popups! -->

      <div id='addFeedWindow' title='Add a feed' class='addFeed'>
        <div style='width: 25em'>
          <div>
            <label for='addFeedUrl'>Feed URL:</label>
            <input type='text' id='addFeedUrl' style='width: 98%%' />
          </div>
          <div id='multifeed'>
            <select id='multifeedOptions'></select>
          </div>
        </div>
        <!-- TODO tags / labels / categories -->
      </div>

      <div id='modifyFeedWindow' title='Modify your feed'>
        <table style='width: 25em'>
          <tr>
            <td><label for='modFeedUrl'>URL:</label></td>
            <td><input type='text' id='modFeedUrl' style='width: 98%' readonly /></td>
          </tr>
          <tr>
            <td><label for='modFeedTitle'>Title:</label></td>
            <td><input type='text' id='modFeedTitle' style='width: 98%' /></td>
          </tr>
          <tr>
            <td><label for='modFeedRefreshInterval'>Refresh every:</label></td>
            <td><input type='text' id='modFeedInterval' min='15' /> minutes</td>
          </tr>
        </table>
      </div>

      <div id='loginWindow' title='Log In' class='login' style='width: 800px'>
        <table style='width: 25em'>
          <tr>
            <td><label for='email'>Email address:</label></td>
            <td><input id='email' type='text' value='dhasenan@gmail.com' /></td>
          </tr>
          <tr>
            <td><label for='password'>Password:</label></td>
            <td><input id='password' type='password' value='password' /></td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
