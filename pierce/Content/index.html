<!DOCTYPE html>

<html>
  <head>
    <meta charset='utf-8'>
    <title>Pierce RSS Reader</title>
    <!--<link rel='stylesheet' href='dock-manager.css'>-->
    <link rel='stylesheet' href='sunny.css' />
    <link rel='stylesheet' href='pierceweb.css' />
    <link rel='icon' href='/Content/favicon.ico' />
    <script type='text/javascript' src='jquery-1.9.1.js'></script>
    <script type='text/javascript' src='jquery-ui-1.10.2.js'></script>
    <script type='text/javascript' src='jquery.layout.js'></script>
    <script type='text/javascript' src='underscore-min.js'></script>
    <script type='text/javascript' src='app.js'></script>

    <!-- underscore templates! -->
    <script id='labelListTemplate' type='text/html'>
      <% $.each(labels, function(i, label) { 
        var count = label.UnreadCount;
        var classes = 'labelBox';
        var labelclass = 'labelName';
        var name = label.Title;
        if (ui.isExpanded(label.Id)) classes += ' expanded'; else classes += ' collapsed';
        if (ui.currentLabel && label.Id == ui.currentLabel.Id && !ui.currentFeed) {
          labelclass += ' selectedItem';
        }
        if (count > 0) {
          labelclass += ' unread';
          name += ' (' + count + ')';
        }
      %>
      <div id='labelBox_<%= label.Id %>' class='<%= classes %>'>
        <table style='width: 100%; text-align: left'>
          <tr>
            <td style='width: 1.2em'>
              <span id='expander_<%= label.Id %>' class='ui-icon ui-icon-circle-minus'
                onclick='ui.toggleExpanded("<%= label.Id %>")'></span>
            </td>
            <td>
              <span id='labelName_<%= label.Id %>' class='<%= labelclass %>'
                  onclick='ui.showLabel("<%= label.Id %>")'
                  style='float: left'
                  >
                <%- name %>
              </span><!-- labelName -->
            </td>
          </tr>
        </table>
        <div id='labelContent_<%= label.Id %>' class='labelContent'>
          <%= ui.template('feedlistTemplate', { feeds: label.Feeds, labelId: label.Id }) %>
        </div><!-- labelContent -->
      </div><!-- labelBox -->
      <%}); %>
    </script>

    <script id='feedlistTemplate' type='text/html'>
      <% $.each(feeds, function(i, feed) { %>
        <div class='feedRow feedRow_<%= feed.Id %> lf_<%= feed.Id %><%= labelId %><%
          if (ui.currentLabel
              && ui.currentLabel.Id == labelId
              && ui.currentFeed
              && ui.currentFeed.Id == feed.Id) {
            print(' selectedItem'); 
          }
          %>'
          onclick='ui.showFeed("<%= feed.Id %>", "<%= labelId %>")'>
          <span style='float: left; overflow: hidden; text-overflow: ellipsis; width: 90%'>
            <%= ui.template('feedli', { feed: feed }) %>
          </span>
          <% if (!feed.Autogenerated) { %>
            <span style='width: 1em; float: right'>
              <%= ui.template('feedmenubutton', { feed: feed }) %>
            </span>
          <% } %>
        </div>
      <% }); %>
    </script>

    <script id='feedli' type='text/html'>
      <span class='feedli_<%- feed.Id %> feedli<%
        var unreadc = feed.UnreadCount;
        if (unreadc > 0) print(' unread'); %>'
        >
        <% if (feed.IconUri) { %>
          <img style='height: 16px; width: 16px;' src='<%- feed.IconUri %>' />
        <% } else { %>
          <img style='height: 16px; width: 16px;' src='/Content/no-icon.png' />
        <% } %>
        <%-  feed.Title  %>
        <%
          if (unreadc) print(' (' + unreadc + ')');
        %>
      </span>
    </script>

    <script id='feedmenubutton' type='text/html'>
      <span
        style='float: right; height: 1em; width: 1em'
        class='ui-icon ui-icon-triangle-e'
        onclick='ui.showUpdateFeedWindow("<%= feed.Id %>")'
      >
      </span>
    </script>

    <script id='articleli' type='text/html'>
      <div
        id='<%- util.articleId(article) %>'
        class='articleli <%- article.IsRead ? "read" : "unread" %>'
        onclick='ui.showArticle("<%= article.Feed.Id %>", "<%= article.Id %>");'>
        <img style='height: 16px; width: 16px;' src='<%= ui.iconUrl(article.Feed) %>' />
        <%- ui.fmtDate(article.PublishDate) %>
        <%- article.Title %>
      </div>
    </script>

    <script id='articlefull' type='text/html'>
      <div>
        <img style='float: left' src='<%= feed.ImageUri %>' />
        <h3><a href="<%= article.Link %>"><%- article.Title %></a> - <%- feed.Title %></h3>
        <div><%- ui.fmtDate(article.PublishDate) %>
          <% if (ui.authors(article)) { %> -- by <%= ui.authors(article) %><% } %></div>
        <!-- as a special case, load this with html unescaped -->
        <frame><%= article.Description || article.Summary %></frame>
      </div>
    </script>

    <script id='authorLink' type='text/html'>
      <% if (author.Link) {%>
        <a href="<%= author.Link %>"><%- author.Name %></a>
      <% } else { %>
        <%- author.Name %>
      <% }%>
    </script>
  </head>
  <body>
    <div id='headerBar'>
      <span id='userName'>Not logged in</span>
      <span style='float: right'><a href='#' onclick='ui.showSettingsWindow()'
          style='color: black'>Settings</a></span>
    </div>
    <div id='mainPanel'>
      <div id='mainPanelCenter'>
        <div id='articleList' caption='Articles' class='articleList pane ui-layout-center'>
          <div class='paneTitle'>
            <span>Articles</span>
            <span style='float: right'>
              <a id='toggleUnread' href='#' onclick='ui.toggleUnreadOnly()'>Unread</a>
            </span>
          </div>
          <div class='content'>
            A list of articles, natch.
          </div>
        </div>

        <div id='articleView' caption='Current article' class='articleView pane ui-layout-south'>
          <div class='paneTitle' id='articleTitle'>Article</div>
          <div class='content' id='articleContent' tabindex='-1'>
            I need an article.
          </div>
        </div>
      </div>

      <div id='feedList' caption='Feeds' class='feedList pane ui-layout-west'>
        <div class='paneTitle'>Feeds</div>
        <div class='content'>
          I need some feeds.
        </div>
        <div style='float: bottom; border-top: 1px solid #aaa'>
          <a id='addFeedButton' href='#'>Add a feed</a>
        </div>
      </div>
    </div>

    <div id='popupContainer' style='display: none'>
      <!-- Popups! -->
      <div id='addFeedWindow' title='Add a feed' class='addFeed'>
        <div>
        <div class="ajaxLoader" style="float: left; display: none">
          <img src="/Content/loadinfo.net.gif" />
        </div>
          <table style='width: 25em'>
            <tr>
              <td><label for='addFeedUrl'>Feed URL:</label></td>
              <td><input type='text' id='addFeedUrl' style='width: 98%%' /></td>
            </tr>
            <tr id='multifeed'>
              <td />
                <td><select id='multifeedOptions'></select></td>
              </tr>
              <tr>
                <td><label for='addFeedTitle'>Title:</label></td>
                <td><input type='text' id='addFeedTitle' style='width: 98%%' /></td>
              </tr>
              <tr>
                <td><label for='addFeedLabels'>Labels:</label></td>
                <td><input type='text' id='addFeedLabels' style='width: 98%%' /></td>
              </tr>
            </table>
        </div>
      </div>

      <div id='modifyFeedWindow' title='Modify your feed'>
        <div class="ajaxLoader" style="float: left; display: none">
          <img src="/Content/loadinfo.net.gif" />
        </div>
        <table style='width: 25em'>
          <tr>
            <td><label for='modFeedUrl'>URL:</label></td>
            <td><input type='text' id='modFeedUrl' style='width: 98%' readonly /></td>
          </tr>
          <tr>
            <td><label for='modFeedTitle'>Title:</label></td>
            <td><input type='text' id='modFeedTitle' style='width: 98%' /></td>
          </tr>
          <tr>
            <td><label for='modFeedLabels'>Labels (separated by commas):</label></td>
            <td><input type='text' id='modFeedLabels' style='width: 98%' /></td>
          </tr>
          <tr>
            <td><label for='modFeedInterval'>Refresh every:</label></td>
            <td><input type='text' id='modFeedInterval' min='15' /> minutes</td>
          </tr>
        </table>
      </div>

      <div id='loginWindow' title='Log In' class='login' style='width: 800px'>
        <div class="ajaxLoader" style="float: left; display: none">
          <img src="/Content/loadinfo.net.gif" />
        </div>
        <table style='width: 25em'>
          <tr>
            <td><label for='email'>Email address:</label></td>
            <td><input id='email' type='text' /></td>
          </tr>
          <tr>
            <td><label for='password'>Password:</label></td>
            <td><input id='password' type='password' /></td>
          </tr>
        </table>
      </div>

      <div id='settingsWindow' title='Settings'>
        <div class="ajaxLoader" style="float: left; display: none">
          <img src="/Content/loadinfo.net.gif" />
        </div>
        <table>
          <tr>
            <td><label for='settingsEmail'>Email address:</label></td>
            <td><input type='text' id='settingsEmail' /></td>
          </tr>
          <tr>
            <td><label for='settingsCurrPassword'>Current password:</label></td>
            <td><input type='password' id='settingsCurrPassword' /></td>
          </tr>
          <tr>
            <td><label for='settingsPassword'>New password:</label></td>
            <td><input type='password' id='settingsPassword' /></td>
          </tr>
          <tr>
            <td><label for='settingsPasswordConf'>Confirm new password:</label></td>
            <td><input type='password' id='settingsPasswordConf' /></td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
